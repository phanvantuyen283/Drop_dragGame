<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Science Game: Life Cycles</title>
    <style>
        :root {
            --primary: #4A90E2; --success: #2ECC71; --warning: #F1C40F; --danger: #E74C3C;
            --dark: #2C3E50; --board-w: 800px; --board-h: 600px;
            --brand: #E91E63;
        }

        body {
            font-family: 'Segoe UI', sans-serif; background-color: #E3F2FD; margin: 0;
            display: flex; justify-content: center; min-height: 100vh; user-select: none; padding: 20px 0;
        }

        .container { width: 100%; max-width: 1000px; text-align: center; }
        .screen { display: none; animation: fadeIn 0.5s ease-in-out; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        /* START SCREEN */
        .start-card {
            background: white; padding: 50px; border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            display: inline-block; margin-top: 60px; width: 550px; border-top: 5px solid var(--primary);
        }
        .start-card h1 { margin-bottom: 10px; color: var(--dark); }
        .start-card p { margin-bottom: 30px; color: #7f8c8d; font-size: 1.2em; }

        input[type="text"] {
            padding: 15px 20px; font-size: 18px; border-radius: 50px; border: 2px solid #E0E0E0; width: 80%;
            margin-bottom: 15px; outline: none; text-align: center;
        }
        
        .brand-text {
            color: var(--brand); font-weight: bold; font-size: 1.2em; margin-bottom: 25px;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }

        .btn-action {
            padding: 15px 45px; border: none; border-radius: 50px; font-size: 20px; font-weight: bold;
            cursor: pointer; color: white; background: var(--primary); transition: all 0.2s;
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.4);
        }
        .btn-action:hover { transform: translateY(-3px); background: #357ABD; }

        /* GAME SCREEN */
        .hud {
            display: flex; justify-content: space-between; align-items: center; background: white;
            padding: 15px 30px; border-radius: 15px; margin-bottom: 20px; font-weight: bold; font-size: 18px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); border-bottom: 3px solid var(--primary);
        }
        .game-board-wrapper {
            position: relative; width: var(--board-w); height: var(--board-h); margin: 0 auto;
            border: 4px solid white; border-radius: 20px; overflow: hidden; background: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        .game-bg { width: 100%; height: 100%; object-fit: contain; pointer-events: none; }

        /* DROP ZONES */
        .drop-zone {
            position: absolute; display: flex; justify-content: center; align-items: center;
            background: rgba(255, 255, 255, 0.95); border: 3px dashed #BDBDBD; border-radius: 12px;
            font-size: 24px; color: #BDBDBD; font-weight: 900; transition: 0.3s;
        }
        .drop-zone.hover { background: #E3F2FD; transform: scale(1.05); border-color: var(--primary); color: var(--primary); }
        
        .drop-zone.correct { 
            background: transparent !important; 
            border: 3px solid var(--success); 
            box-shadow: none; 
        }
        .drop-zone.correct span { display: none; }
        .drop-zone.correct img { animation: popIn 0.5s; }

        /* LAYER CONTROL */
        .z-bird-img { z-index: 10; background: rgba(255, 255, 255, 0.8); }
        .z-bird-txt { z-index: 20; background: rgba(255, 255, 255, 0.85); border-color: var(--primary); color: var(--primary); }

        /* DOCK */
        .dock {
            margin-top: 25px; min-height: 110px; display: flex; justify-content: center; gap: 20px;
            flex-wrap: wrap; background: white; padding: 20px; border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); border-top: 3px solid #BDBDBD;
        }
        .draggable {
            background: var(--primary); color: white; padding: 12px 25px; border-radius: 12px;
            cursor: grab; font-weight: bold; font-size: 18px; box-shadow: 0 5px 0 #2980b9;
        }
        .draggable:active { transform: translateY(4px); box-shadow: 0 1px 0 #2980b9; }
        .draggable.img-card {
            background: white; border: 3px solid var(--primary); padding: 5px; width: 85px; height: 85px;
            display: flex; align-items: center; justify-content: center;
        }
        .draggable.img-card img { max-width: 100%; max-height: 100%; object-fit: contain; pointer-events: none; }

        /* MODAL */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7);
            display: none; justify-content: center; align-items: center; z-index: 100; backdrop-filter: blur(8px);
        }
        .modal-box {
            background: white; padding: 40px; border-radius: 25px; text-align: center; width: 450px;
            animation: slideUp 0.4s ease-out;
        }
        @keyframes slideUp { from {transform: translateY(50px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }
        @keyframes popIn { from {transform: scale(0.5); opacity: 0;} to {transform: scale(1); opacity: 1;} }
        .stat-box { background:#F8F9FA; padding:15px; margin:25px 0; border-radius:15px; text-align:left; border-left: 5px solid; }

        /* --- T·ªåA ƒê·ªò V·ªä TR√ç --- */
        /* LEVEL 1: FROG */
        .z-frog { width: 120px; height: 40px; z-index: 10; background: rgba(255,255,255,0.95); }
        #dz-frog { top: 20%; left: 42%; }
        #dz-eggs { top: 49%; left: 78%; }
        #dz-tadpole { top: 78%; left: 68%; }
        #dz-legs { top: 84%; left: 17%; }
        #dz-froglet { top: 49%; left: 3%; }

        /* LEVEL 2: BIRD */
        .z-bird-txt { width: 110px; height: 35px; }
        .z-bird-img { width: 90px; height: 90px; border-radius: 50%; border-color: var(--warning); color: var(--warning); }
        
        #dz-t-egg { top: 42%; left: 44%; } 
        
        #dz-i-hatch { top: 33%; left: 73%; } #dz-t-hatch { top: 51%; left: 71%; }
        #dz-i-chick { top: 62%; left: 45%; } #dz-t-chick { top: 80%; left: 44%; }
        #dz-i-bird { top: 33%; left: 15%; } #dz-t-bird { top: 42%; left: 14%; }

    </style>
</head>
<body>

    <div id="screen-start" class="screen active">
        <div class="container">
            <div class="start-card">
                <h1>üß¨ SCIENCE EXPLORER</h1>
                <p>Discover Animal Life Cycles</p>
                <input type="text" id="inp-name" placeholder="Enter your name..." autocomplete="off">
                <div class="brand-text">üë©‚Äçüè´ S·∫£n ph·∫©m th·ª≠ nghi·ªám c·ªßa Tuy·∫øn Trainer</div>
                <button class="btn-action" onclick="Game.start()">START GAME ‚ñ∂</button>
            </div>
        </div>
    </div>

    <div id="screen-game" class="screen">
        <div class="container">
            <div class="hud">
                <div>üë§ <span id="ui-player" style="color: var(--primary)">Student</span></div>
                <div>‚è≥ <span id="ui-timer" style="color: var(--warning)">90</span>s</div>
                <div>‚≠ê Score: <span id="ui-score" style="color: var(--success)">0</span></div>
            </div>
            
            <h2 id="ui-title" style="margin: 0 0 5px 0; color: var(--dark)">Level Title</h2>
            <p id="ui-guide" style="margin: 0 0 20px 0; color: #666">Instructions</p>

            <div class="game-board-wrapper">
                <img id="game-bg" class="game-bg" src="" alt="Background">
                <div id="zones-area"></div>
            </div>

            <div id="dock" class="dock"></div>
        </div>
    </div>

    <div id="modal" class="modal-overlay">
        <div class="modal-box">
            <h2 id="modal-title">Result</h2>
            <p id="modal-msg">...</p>
            <div id="stat-box-container" class="stat-box">
                <p>‚úÖ Correct: <b id="stat-correct">0</b></p>
                <p>‚≠ê Score: <b id="stat-score">0</b></p>
            </div>
            <button id="modal-btn" class="btn-action">Continue</button>
        </div>
    </div>

    <script>
        // --- SOUND & SPEECH MANAGER ---
        const AudioSys = {
            ctx: null,
            init: function() {
                try {
                    window.AudioContext = window.AudioContext || window.webkitAudioContext;
                    this.ctx = new AudioContext();
                } catch(e) { console.log('Audio API not supported'); }
            },
            
            // T·∫°o √¢m thanh ƒëi·ªán t·ª≠ (Beep)
            playTone: function(freq, type, duration) {
                if (!this.ctx) this.init();
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + duration);
            },

            playCorrect: function() {
                // √Çm thanh "Ting Ting" (High pitch sine wave)
                this.playTone(600, 'sine', 0.1);
                setTimeout(() => this.playTone(800, 'sine', 0.2), 150);
            },

            playWrong: function() {
                // √Çm thanh "√àuu" (Low pitch sawtooth)
                this.playTone(150, 'sawtooth', 0.3);
            },

            // ƒê·ªçc vƒÉn b·∫£n (Text to Speech)
            speak: function(text) {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel(); // D·ª´ng c√¢u ƒëang ƒë·ªçc d·ªü
                    const utter = new SpeechSynthesisUtterance(text);
                    utter.lang = 'en-US'; // Gi·ªçng M·ªπ
                    utter.rate = 0.9; // T·ªëc ƒë·ªô v·ª´a ph·∫£i
                    window.speechSynthesis.speak(utter);
                }
            }
        };

        const Game = {
            data: {
                1: {
                    title: "LEVEL 1: FROG LIFE CYCLE üê∏",
                    guide: "Drag the English words to the correct spots.",
                    bg: "frog.jpg",
                    items: [
                        { id: "i-frog", text: "Frog", type: "txt" },
                        { id: "i-eggs", text: "Eggs", type: "txt" },
                        { id: "i-tadpole", text: "Tadpole", type: "txt" },
                        { id: "i-legs", text: "Tadpole w/ legs", type: "txt" },
                        { id: "i-froglet", text: "Froglet", type: "txt" }
                    ],
                    zones: [
                        { match: "i-frog", id: "dz-frog", class: "z-frog" },
                        { match: "i-eggs", id: "dz-eggs", class: "z-frog" },
                        { match: "i-tadpole", id: "dz-tadpole", class: "z-frog" },
                        { match: "i-legs", id: "dz-legs", class: "z-frog" },
                        { match: "i-froglet", id: "dz-froglet", class: "z-frog" }
                    ]
                },
                2: {
                    title: "LEVEL 2: BIRD LIFE CYCLE üê¶",
                    guide: "Drag PICTURES and WORDS to correct spots.",
                    bg: "birb_bg.jpg", 
                    items: [
                        { id: "t-bird", text: "Bird", type: "txt" }, 
                        { id: "t-egg", text: "Egg", type: "txt" },
                        { id: "t-hatch", text: "Hatchling", type: "txt" }, 
                        { id: "t-chick", text: "Chick", type: "txt" },
                        { id: "p-bird", img: "birb_adult", type: "img", label: "Bird" }, // Label for speech
                        { id: "p-hatch", img: "hatchling", type: "img", label: "Hatchling" }, 
                        { id: "p-chick", img: "chick", type: "img", label: "Chick" }
                    ],
                    zones: [
                        { match: "t-bird", id: "dz-t-bird", class: "z-bird-txt" }, { match: "t-egg", id: "dz-t-egg", class: "z-bird-txt" },
                        { match: "t-hatch", id: "dz-t-hatch", class: "z-bird-txt" }, { match: "t-chick", id: "dz-t-chick", class: "z-bird-txt" },
                        { match: "p-bird", id: "dz-i-bird", class: "z-bird-img" }, 
                        { match: "p-hatch", id: "dz-i-hatch", class: "z-bird-img" }, { match: "p-chick", id: "dz-i-chick", class: "z-bird-img" }
                    ]
                }
            },
            
            state: { lv: 1, score: 0, tempScore: 0, correct: 0, timer: null, time: 90 },

            start: function() {
                const name = document.getElementById('inp-name').value.trim();
                if(!name) { alert("Please enter your name first!"); return; }
                
                // Kh·ªüi t·∫°o √¢m thanh (c·∫ßn t∆∞∆°ng t√°c ng∆∞·ªùi d√πng ƒë·ªÉ b·∫≠t)
                AudioSys.init();
                AudioSys.speak("Welcome " + name);

                document.getElementById('ui-player').innerText = name;
                document.getElementById('screen-start').classList.remove('active');
                document.getElementById('screen-game').classList.add('active');
                this.loadLevel(1);
            },

            loadLevel: function(lv) {
                this.state.lv = lv;
                this.state.time = 90;
                this.state.correct = 0;
                this.state.tempScore = 0;
                
                const d = this.data[lv];
                document.getElementById('ui-title').innerText = d.title;
                document.getElementById('ui-guide').innerText = d.guide;
                document.getElementById('game-bg').src = d.bg;
                document.getElementById('ui-timer').innerText = 90; 
                document.getElementById('ui-timer').style.color = "var(--warning)";

                const zArea = document.getElementById('zones-area');
                zArea.innerHTML = "";
                
                d.zones.forEach(z => {
                    const div = document.createElement('div');
                    div.className = `drop-zone ${z.class}`;
                    div.id = z.id;
                    div.setAttribute('data-target', z.match);
                    
                    if(z.class.includes('z-bird-img')) {
                         div.innerHTML = `<span style="font-size: 11px; color: #888; text-align: center; line-height: 1.2; font-weight: normal;">Drop<br>Picture<br>Here</span>`;
                    } else {
                         div.innerHTML = "<span>?</span>";
                    }
                    
                    div.addEventListener('dragover', e => { e.preventDefault(); div.classList.add('hover'); });
                    div.addEventListener('dragleave', () => div.classList.remove('hover'));
                    div.addEventListener('drop', this.handleDrop);
                    zArea.appendChild(div);
                });

                const dock = document.getElementById('dock');
                dock.innerHTML = "";
                const items = [...d.items].sort(() => Math.random() - 0.5);
                
                items.forEach(item => {
                    const div = document.createElement('div');
                    div.id = item.id;
                    div.draggable = true;
                    
                    // X√°c ƒë·ªãnh t·ª´ c·∫ßn ƒë·ªçc
                    const speechText = item.type === 'txt' ? item.text : (item.label || "Picture");

                    if(item.type === 'txt') {
                        div.className = "draggable";
                        div.innerText = item.text;
                    } else {
                        div.className = "draggable img-card";
                        div.innerHTML = `<img src="${item.img}.png" onerror="this.src='${item.img}.jpg'" draggable="false">`; 
                    }
                    
                    // Event: K√©o th√¨ ƒë·ªçc t√™n
                    div.addEventListener('dragstart', e => {
                        AudioSys.speak(speechText); // ƒê·ªåC T√äN
                        e.dataTransfer.setData('text', item.id);
                        setTimeout(() => div.style.opacity = 0.5, 0);
                    });
                    
                    // Event: Click v√†o c≈©ng ƒë·ªçc t√™n
                    div.addEventListener('mousedown', () => {
                        AudioSys.speak(speechText);
                    });

                    div.addEventListener('dragend', () => div.style.opacity = 1);
                    dock.appendChild(div);
                });

                clearInterval(this.state.timer);
                this.state.timer = setInterval(() => {
                    this.state.time--;
                    const timerEl = document.getElementById('ui-timer');
                    timerEl.innerText = this.state.time;
                    if(this.state.time <= 10) timerEl.style.color = "var(--danger)";
                    if(this.state.time <= 0) this.endLevel(false);
                }, 1000);
            },

            handleDrop: function(e) {
                e.preventDefault();
                const zone = e.currentTarget;
                zone.classList.remove('hover');
                if(zone.classList.contains('correct')) return;

                const itemId = e.dataTransfer.getData('text');
                const targetId = zone.getAttribute('data-target');
                const itemEl = document.getElementById(itemId);

                if(!itemEl) return;

                if(itemId === targetId) {
                    // --- ƒê√öNG ---
                    AudioSys.playCorrect(); // √Çm thanh TING
                    // Ng·∫´u nhi√™n l·ªùi khen
                    const praises = ["Correct!", "Good job!", "Excellent!", "Well done!"];
                    AudioSys.speak(praises[Math.floor(Math.random() * praises.length)]);

                    zone.classList.add('correct');
                    if(itemEl.classList.contains('img-card')) {
                        zone.innerHTML = itemEl.innerHTML;
                    } else {
                        zone.innerText = itemEl.innerText;
                    }
                    itemEl.style.display = 'none';
                    Game.state.tempScore += 10;
                    Game.state.correct++;
                    Game.updateScore();

                    if(Game.state.correct === Game.data[Game.state.lv].items.length) {
                        setTimeout(() => Game.endLevel(true), 500);
                    }
                } else {
                    // --- SAI ---
                    AudioSys.playWrong(); // √Çm thanh √àUU
                    AudioSys.speak("Try again!");
                    
                    zone.style.borderColor = "var(--danger)";
                    zone.style.animation = "shake 0.3s";
                    setTimeout(() => {
                        zone.style.borderColor = "";
                        zone.style.animation = "";
                    }, 300);
                }
            },

            updateScore: function() {
                document.getElementById('ui-score').innerText = Game.state.score + Game.state.tempScore;
            },

            endLevel: function(win) {
                clearInterval(this.state.timer);
                const modal = document.getElementById('modal');
                const title = document.getElementById('modal-title');
                const msg = document.getElementById('modal-msg');
                const btn = document.getElementById('modal-btn');
                const statBox = document.getElementById('stat-box-container');

                modal.style.display = 'flex';
                document.getElementById('stat-correct').innerText = `${this.state.correct} / ${this.data[this.state.lv].items.length}`;
                document.getElementById('stat-score').innerText = this.state.tempScore;

                if(win) {
                    AudioSys.playCorrect();
                    title.innerText = "üéâ EXCELLENT!";
                    title.style.color = "var(--success)";
                    statBox.style.borderColor = "var(--success)";
                    
                    if(this.state.lv === 1) {
                        msg.innerText = "You completed Level 1. Ready for Level 2?";
                        btn.innerText = "Go to Level 2 ‚û°";
                        btn.style.background = "var(--primary)";
                        btn.onclick = () => {
                            Game.state.score += Game.state.tempScore;
                            modal.style.display = 'none';
                            Game.loadLevel(2);
                        }
                    } else {
                        AudioSys.speak("Congratulations! You won!");
                        msg.innerText = "CONGRATULATIONS! YOU WON THE GAME! üèÜ";
                        btn.innerText = "Play Again üîÑ";
                        btn.style.background = "var(--success)";
                        btn.onclick = () => location.reload();
                    }
                } else {
                    AudioSys.playWrong();
                    title.innerText = "‚åõ TIME'S UP!";
                    title.style.color = "var(--danger)";
                    statBox.style.borderColor = "var(--danger)";
                    msg.innerText = "Oh no! Time ran out. Let's try this level again!";
                    btn.innerText = "Retry Level ‚Ü©";
                    btn.style.background = "var(--warning)";
                    btn.onclick = () => {
                        modal.style.display = 'none';
                        Game.loadLevel(Game.state.lv);
                        document.getElementById('ui-score').innerText = Game.state.score;
                    }
                }
            }
        };

        const style = document.createElement('style');
        style.innerHTML = `
            @keyframes shake {
                0% { transform: translateX(0); } 25% { transform: translateX(-5px); }
                50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); }
            }
        `;
        document.head.appendChild(style);

    </script>
</body>
</html>
